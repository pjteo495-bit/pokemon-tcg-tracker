<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Global Prices - POKEGR</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{--poke-blue:#2A75BB;--poke-yellow:#FFCC00;--bg:#0b1220;--panel:#121a2b;--card-bg:#16223a;--text:#eaf1ff;--muted:#a7b6d6;--border:#23314c}
    body{font-family:'Poppins',sans-serif;background-color:var(--bg);color:var(--text);
         background-image:linear-gradient(rgba(11,18,32,.85),rgba(11,18,32,.85)),url('https://cdn.midjourney.com/9fdabdd5-ee83-470f-b488-ecbf9f08ea8b/0_0.png');
         background-size:cover;background-attachment:fixed; overflow-x: hidden;}
    .wrap{max-width:1200px;margin:0 auto;padding:22px 16px 42px;}
    .header{display:flex;justify-content:space-between;align-items:center;padding-bottom:15px;border-bottom:1px solid var(--border);margin-bottom:2rem;}
    .logo{display:flex;align-items:center;gap:12px;text-decoration:none;color:var(--text)}
    .logo h1 { margin: 0; font-size: 28px; font-weight: 800; color: var(--text); }
    .nav-buttons { display: flex; gap: 15px; align-items: center; }
    .nav-btn{display:inline-flex;align-items:center;gap:8px;padding:10px 20px;background:var(--poke-blue);color:#fff;border-radius:12px;text-decoration:none;font-weight:700;transition:.2s}
    .nav-btn:hover{background:#1b4f8e;transform:translateY(-2px)}
    .page-title{text-align:center;font-size:2.5rem;font-weight:800;margin:20px 0 10px}
    .page-description { text-align: center; color: var(--muted); margin-bottom: 30px; max-width: 600px; margin-left: auto; margin-right: auto; }
    .search-container{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:24px}
    .search-container input{width:100%;height:52px;border-radius:12px;border:1px solid var(--border);background:var(--panel);color:#fff;padding:0 18px;font-size:16px;outline:none}
    .results-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px}
    .product-card{background-color:var(--card-bg);border:1px solid var(--border);border-radius:18px;padding:15px;text-align:center}
    .product-card img{width:100%;height:220px;object-fit:contain;background:#fff;border-radius:12px;margin-bottom:12px;image-rendering:auto}
    .product-card h3{font-weight:700;margin-bottom:4px}
    .product-card p{color:var(--muted);margin-bottom:10px}
    .price{color:var(--poke-yellow);font-weight:800;font-size:1.2rem;margin-bottom:12px}
    .ebay-btn{display:inline-block;width:100%;padding:10px;background:#5a5a5a;color:#fff;border-radius:10px;text-decoration:none;font-weight:600}
    
    /* Mobile Nav Styles */
    .mobile-nav-toggle { display: none; }
    .mobile-nav {
        position: fixed; top: 0; left: -280px; width: 280px; height: 100%;
        background: var(--panel); padding: 20px; z-index: 1000;
        transition: left 0.3s ease-in-out;
        border-right: 1px solid var(--border);
    }
    .mobile-nav.open { left: 0; }
    .mobile-nav a {
        display: block; color: var(--text); text-decoration: none;
        font-size: 18px; padding: 15px 0; border-bottom: 1px solid var(--border);
    }
    .mobile-nav a i { margin-right: 10px; }

    @media (max-width: 768px) {
        .nav-buttons { display: none; }
        .mobile-nav-toggle {
            display: block;
            background: none; border: none; color: var(--text);
            font-size: 24px; cursor: pointer;
        }
        .header {
            display: grid;
            grid-template-columns: 40px 1fr 40px;
            align-items: center;
            width: 100%;
        }
        .mobile-nav-toggle {
            grid-column: 1 / 2;
            justify-self: start;
        }
        .logo {
            grid-column: 2 / 3;
            justify-self: center;
        }
    }
  </style>
</head>
<body>
  <div class="mobile-nav" id="mobileNav">
      <a href="/"><i class="fas fa-store"></i> Marketplace</a>
      <a href="/tcg-tracker"><i class="fas fa-search"></i> TCG Tracker</a>
      <a href="/top100"><i class="fas fa-fire"></i> Top 100</a>
      <a href="/wallpapers"><i class="fas fa-image"></i> Wallpapers</a>
      <a href="/global-prices"><i class="fas fa-globe"></i> Global Prices</a>
  </div>
  <div class="wrap">
    <header class="header">
        <button class="mobile-nav-toggle" id="mobileNavOpen"><i class="fas fa-bars"></i></button>
        <a href="/" class="logo">
            <img src="https://i.ibb.co/fYS2Brhp/pikachu-tsolias.png" alt="Pokegr Logo" width="42" height="42">
            <h1>POKEGR</h1>
        </a>
        <div class="nav-buttons">
            <a href="/" class="nav-btn"><i class="fas fa-store"></i> <span>Marketplace</span></a>
            <a href="/tcg-tracker" class="nav-btn"><i class="fas fa-search"></i> <span>TCG Tracker</span></a>
            <a href="/top100" class="nav-btn"><i class="fas fa-fire"></i> <span>Top 100</span></a>
            <a href="/wallpapers" class="nav-btn"><i class="fas fa-image"></i> <span>Wallpapers</span></a>
            <a href="/global-prices" class="nav-btn"><i class="fas fa-globe"></i> <span>Global Prices</span></a>
        </div>
    </header>

    <h2 class="page-title">Global Prices</h2>
    <p class="page-description">Global average prices for sealed Pokemon TCG items.</p>

    <div class="search-container">
      <input type="text" id="setSearch"  placeholder="Search by Set Name...">
      <input type="text" id="typeSearch" placeholder="Search by Item Type (e.g., Booster Box)...">
    </div>

    <div id="resultsGrid" class="results-grid"></div>
  </div>

  <script>
    // --- MOBILE NAV SCRIPT ---
    const mobileNav = document.getElementById('mobileNav');
    const openBtn = document.getElementById('mobileNavOpen');
    
    openBtn.addEventListener('click', () => {
        mobileNav.classList.toggle('open');
    });
    
    document.addEventListener('click', (e) => {
        if (!mobileNav.contains(e.target) && !openBtn.contains(e.target)) {
            mobileNav.classList.remove('open');
        }
    });

    const setSearch   = document.getElementById('setSearch');
    const typeSearch  = document.getElementById('typeSearch');
    const resultsGrid = document.getElementById('resultsGrid');
    const fmtEUR      = new Intl.NumberFormat('el-GR', { style: 'currency', currency: 'EUR' });

    let allProducts = [];

    async function fetchProducts(){
      try{
        resultsGrid.innerHTML = `<p>Loading prices...</p>`;
        const res = await fetch('/api/sealed-products');
        if(!res.ok){
          resultsGrid.innerHTML = `<p>Failed to load data (${res.status}).</p>`;
          return;
        }
        allProducts = await res.json();
        renderProducts();
      }catch(err){
        console.error(err);
        resultsGrid.innerHTML = `<p>Failed to load data.</p>`;
      }
    }

    function renderProducts(){
      const setQ  = setSearch.value.toLowerCase();
      const typeQ = typeSearch.value.toLowerCase();

      const filtered = allProducts.filter(p => {
        return (p.set_name||'').toLowerCase().includes(setQ)
            && (p.item_title||'').toLowerCase().includes(typeQ);
      });
      
      if (filtered.length === 0) {
        resultsGrid.innerHTML = `<p>No products found matching your criteria.</p>`;
        return;
      }

      resultsGrid.innerHTML = filtered.map(p => {
        const hd  = p.image_url_hd  || p.image_url || '';
        const xhd = p.image_url_xhd || hd;
        const ebayQuery = encodeURIComponent(`${p.set_name || ''} ${p.item_title || ''}`);
        const price = (typeof p.price_eur === 'number') ? p.price_eur : 0;

        return `
          <div class="product-card">
            <img loading="lazy" referrerpolicy="no-referrer"
                 src="${hd}"
                 srcset="${hd} 1x, ${xhd} 2x"
                 alt="${(p.set_name||'') + ' ' + (p.item_title||'')}">
            <h3>${p.set_name || 'â€”'}</h3>
            <p>${p.item_title || ''}</p>
            <div class="price">${fmtEUR.format(price)}</div>
            <a class="ebay-btn" target="_blank" rel="noopener noreferrer"
               href="https://www.ebay.com/sch/i.html?_nkw=${ebayQuery}">
              Check eBay
            </a>
          </div>
        `;
      }).join('');
    }

    setSearch.addEventListener('input', renderProducts);
    typeSearch.addEventListener('input', renderProducts);
    document.addEventListener('DOMContentLoaded', fetchProducts);
  </script>
</body>
</html>

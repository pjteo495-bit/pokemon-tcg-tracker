<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sealed Products Prices - POKEGR</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{--poke-blue:#2A75BB;--poke-yellow:#FFCC00;--bg:#0b1220;--panel:#121a2b;--card-bg:#16223a;--text:#eaf1ff;--muted:#a7b6d6;--border:#23314c}
    body{font-family:'Poppins',sans-serif;background-color:var(--bg);color:var(--text);
         background-image:linear-gradient(rgba(11,18,32,.85),rgba(11,18,32,.85)),url('https://cdn.midjourney.com/9fdabdd5-ee83-470f-b488-ecbf9f08ea8b/0_0.png');
         background-size:cover;background-attachment:fixed;}
    .wrap{max-width:1200px;margin:0 auto;padding:22px 16px 42px;}
    .header{display:flex;justify-content:space-between;align-items:center;padding-bottom:15px;border-bottom:1px solid var(--border);margin-bottom:2rem;}
    .logo{display:flex;align-items:center;gap:12px;text-decoration:none;color:var(--text)}
    h2{text-align:center;font-size:2.5rem;font-weight:800;margin:20px 0 30px}
    .nav-btn{display:inline-flex;align-items:center;gap:8px;padding:10px 20px;background:var(--poke-blue);color:#fff;border-radius:12px;text-decoration:none;font-weight:700;transition:.2s}
    .nav-btn:hover{background:#1b4f8e;transform:translateY(-2px)}
    .search-container{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:24px}
    .search-container input{width:100%;height:52px;border-radius:12px;border:1px solid var(--border);background:var(--panel);color:#fff;padding:0 18px;font-size:16px;outline:none}
    .results-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px}
    .product-card{background-color:var(--card-bg);border:1px solid var(--border);border-radius:18px;padding:15px;text-align:center}
    .product-card img{width:100%;height:220px;object-fit:contain;background:#fff;border-radius:12px;margin-bottom:12px;image-rendering:auto}
    .product-card h3{font-weight:700;margin-bottom:4px}
    .product-card p{color:var(--muted);margin-bottom:10px}
    .price{color:var(--poke-yellow);font-weight:800;font-size:1.2rem;margin-bottom:12px}
    .ebay-btn{display:inline-block;width:100%;padding:10px;background:#5a5a5a;color:#fff;border-radius:10px;text-decoration:none;font-weight:600}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="header">
      <a href="/" class="logo"><img src="https://i.ibb.co/fYS2Brhp/pikachu-tsolias.png" alt="" width="42" height="42"><strong>POKEGR</strong></a>
      <div>
        <a href="/tcg-tracker" class="nav-btn">TCG Tracker</a>
        <a href="/top100" class="nav-btn">Top 100</a>
        <a href="/wallpapers" class="nav-btn">Wallpapers</a>
        <a href="/sealed-products" class="nav-btn">Sealed Products Prices</a>
      </div>
    </header>

    <h2>Sealed Product Prices</h2>

    <div class="search-container">
      <input type="text" id="setSearch"  placeholder="Search by Set Name...">
      <input type="text" id="typeSearch" placeholder="Search by Item Type (e.g., Booster Box)...">
    </div>

    <div id="resultsGrid" class="results-grid"></div>
  </div>

  <script>
    const setSearch   = document.getElementById('setSearch');
    const typeSearch  = document.getElementById('typeSearch');
    const resultsGrid = document.getElementById('resultsGrid');
    const fmtEUR      = new Intl.NumberFormat('el-GR', { style: 'currency', currency: 'EUR' });

    let allProducts = [];

    async function fetchProducts(){
      try{
        const res = await fetch('/api/sealed-products');
        if(!res.ok){
          resultsGrid.innerHTML = `<p>Failed to load data (${res.status}).</p>`;
          return;
        }
        allProducts = await res.json();
        renderProducts();
      }catch(err){
        console.error(err);
        resultsGrid.innerHTML = `<p>Failed to load data.</p>`;
      }
    }

    function renderProducts(){
      const setQ  = setSearch.value.toLowerCase();
      const typeQ = typeSearch.value.toLowerCase();

      const filtered = allProducts.filter(p => {
        return (p.set_name||'').toLowerCase().includes(setQ)
            && (p.item_title||'').toLowerCase().includes(typeQ);
      });

      resultsGrid.innerHTML = filtered.map(p => {
        // Provide srcset so HiDPI screens use the larger variant
        const hd  = p.image_url_hd  || p.image_url || '';
        const xhd = p.image_url_xhd || hd;

        const ebayQuery = encodeURIComponent(`${p.set_name || ''} ${p.item_title || ''}`);
        const price = (typeof p.price_eur === 'number') ? p.price_eur : 0;

        return `
          <div class="product-card">
            <img loading="lazy" referrerpolicy="no-referrer"
                 src="${hd}"
                 srcset="${hd} 1x, ${xhd} 2x"
                 alt="${(p.set_name||'') + ' ' + (p.item_title||'')}">
            <h3>${p.set_name || 'â€”'}</h3>
            <p>${p.item_title || ''}</p>
            <div class="price">${fmtEUR.format(price)}</div>
            <a class="ebay-btn" target="_blank" rel="noopener noreferrer"
               href="https://www.ebay.com/sch/i.html?_nkw=${ebayQuery}">
              Check eBay
            </a>
          </div>
        `;
      }).join('');
    }

    setSearch.addEventListener('input', renderProducts);
    typeSearch.addEventListener('input', renderProducts);
    document.addEventListener('DOMContentLoaded', fetchProducts);
  </script>
</body>
</html>
